import{_ as e,r as a,o as t,c as l,a as n,w as u,b as s,d as i,e as o,v,f as d,g as p,F as h,i as c,t as r}from"./index-5fa3503f.js";import{i as g,S as m,a as x,b as y,s as f}from"./ShowDataObj-75f42c8b.js";import{S as w,D as b}from"./DownloadImage-ab76d0e4.js";import{G as I,c as N}from"./copyText-596cf644.js";const D={key:0},U={key:0,class:"setBox"},k={key:1,class:"setBox"},j={key:0,class:"msgBox"},C="imagecrop",V=e({__name:"ImageCrop",setup(e){const V=a(g(C,[])),E=a([]);function _(e){E.value.push(e)}const S=a(!1);function P(){S.value=!S.value}const q=a([]),z=a("");function B(e){let{scaleW:a,scaleH:t}=e,l=[];e.points.forEach((e=>{let n=parseInt(e.x*a),u=parseInt(e.y*t);l.push({x:n,y:u})})),function(e,a){e.x<a.x?(J.value=e.x,M.value=a.x):(J.value=a.x,M.value=e.x);e.x<a.x?(K.value=e.y,Q.value=a.y):(K.value=a.y,Q.value=e.y)}(l[0],l[1]),q.value=l}function G(){q.value=[]}function L(){let e=O(q.value[0],q.value[1]);z.value=e,N(e)}function O(e,a){let t,l,n,u;return e.x<a.x?(t=e.x,n=a.x-e.x):(t=a.x,n=e.x-a.x),e.y<a.y?(l=e.y,u=a.y-e.y):(l=a.y,u=e.y-a.y),[t,l,n,u]}const R=a([]);function $(){let e;if(""===z.value){if(2!==q.value.length)return;e=O(q.value[0],q.value[1])}else e=z.value;4===e.length&&(R.value=[],E.value.forEach(((a,t)=>{((e,a,t,l)=>new Promise(((n,u)=>{if(void 0===e.base64)return void u("image no base64");if(4!==a.length)return void u("arr length is not 4");if(t<0||t>.97)return void u("quality must be between 0 and 0.97");let s=parseInt(a[0]),i=parseInt(a[1]),o=parseInt(a[2]),v=parseInt(a[3]);if(o<10||v<10)return void u("width or height too small");const d=new Image;d.onload=()=>{s<0&&(s=0),i<0&&(i=0),o>d.width&&(o=d.width),v>d.height&&(v=d.height),s+o>d.width&&(s=d.width-o),i+v>d.height&&(i=d.height-v);const e=document.createElement("canvas");e.width=o,e.height=v,e.getContext("2d").drawImage(d,s,i,o,v,0,0,o,v);const a="image/jpeg",u=e.toDataURL(a,t);let p=u.length-`data:${a};base64,`.length;p=parseInt(p-p/4);const h=Date.parse(new Date)/100+l;n({size:p,type:a,timeStamp:h,base64:u})},d.src=e.base64})))(a,e,.3,t).then((e=>{R.value.push(e)})).catch((e=>{}))})))}const H=a(0),F=a(0),T=a(0),W=a(0);function A(){let e=parseInt(H.value),a=parseInt(F.value),t=parseInt(T.value),l=parseInt(W.value);isNaN(e)||isNaN(a)||isNaN(t)||isNaN(l)||E.value.forEach(((n,u)=>{((e,a,t,l,n,u,s)=>new Promise(((i,o)=>{if(void 0===e.base64)return void o("image no base64");if(u<0||u>.97)return void o("quality must be between 0 and 0.97");const v=new Image;v.onload=()=>{a<0&&(a=0),t<0&&(t=0),l<0&&(l=0),n<0&&(n=0),a+l>v.height&&(a=0,l=0),n+t>v.width&&(n=0,t=0);let e=n,o=a,d=v.width-n-t,p=v.height-a-l;const h=document.createElement("canvas");h.width=d,h.height=p,h.getContext("2d").drawImage(v,e,o,d,p,0,0,d,p);const c="image/jpeg",r=h.toDataURL(c,u);let g=r.length-`data:${c};base64,`.length;g=parseInt(g-g/4);const m=Date.parse(new Date)/100+s;i({size:g,type:c,timeStamp:m,base64:r})},v.src=e.base64})))(n,e,a,t,l,.3,u).then((e=>{R.value.push(e)})).catch((e=>{}))}))}const J=a(0),K=a(0),M=a(0),Q=a(0);function X(){let e=parseInt(J.value),a=parseInt(K.value),t=parseInt(M.value),l=parseInt(Q.value);isNaN(e)||isNaN(a)||isNaN(t)||isNaN(l)||E.value.forEach(((n,u)=>{((e,a,t,l,n,u,s)=>new Promise(((i,o)=>{if(void 0===e.base64)return void o("image no base64");if(u<0||u>.97)return void o("quality must be between 0 and 0.97");const v=new Image;a<0&&(a=0),t<0&&(t=0),l<0&&(l=0),n<0&&(n=0);let d=0;a>l&&(d=a,a=l,l=d),t>n&&(d=t,t=n,n=d),v.onload=()=>{a>v.width&&(a=v.width),t>v.height&&(t=v.height),l>v.width&&(l=v.width),n>v.height&&(n=v.height),l-a==v.width&&(l=a),n-t==v.height&&(n=t);let e=v.width-l,o=v.height-n;const d=document.createElement("canvas");d.width=a+e,d.height=t+o;const p=d.getContext("2d");p.drawImage(v,0,0,a,t,0,0,a,t),p.drawImage(v,l,0,e,t,a,0,e,t),p.drawImage(v,0,n,a,o,0,t,a,o),p.drawImage(v,l,n,e,o,a,t,e,o);const h="image/jpeg",c=d.toDataURL(h,u);let r=c.length-`data:${h};base64,`.length;r=parseInt(r-r/4);const g=Date.parse(new Date)/100+s;i({size:r,type:h,timeStamp:g,base64:c})},v.src=e.base64})))(n,e,a,t,l,.3,u).then((e=>{R.value.push(e)})).catch((e=>{}))}))}function Y(){let e={name:"",top:H.value,right:F.value,bottom:T.value,left:W.value,x1:J.value,y1:K.value,x2:M.value,y2:Q.value,cropData:z.value,points:q.value};y(e,V.value)||(V.value.push(e),f(C,V.value))}function Z(e){H.value=e.top,F.value=e.right,T.value=e.bottom,W.value=e.left,J.value=e.x1,K.value=e.y1,M.value=e.x2,Q.value=e.y2,z.value=e.cropData,q.value=e.points}function ee(e){f(C,e)}return(e,a)=>(t(),l(h,null,[n(m,{multiple:"",onGetImage:_},{default:u((()=>[E.value.length>0?(t(),l("div",D,[s("button",{onClick:P},"选点"),o(s("input",{type:"text",placeholder:"x,y,width,height","onUpdate:modelValue":a[0]||(a[0]=e=>z.value=e),id:"cropData"},null,512),[[v,z.value]]),s("button",{onClick:$},"裁剪")])):d("",!0)])),_:1}),E.value.length>0?(t(),l("div",U,[s("div",null,[a[9]||(a[9]=i("上：")),o(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[1]||(a[1]=e=>H.value=e),class:"inp"},null,512),[[v,H.value]])]),s("div",null,[a[10]||(a[10]=i("右：")),o(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[2]||(a[2]=e=>F.value=e),class:"inp"},null,512),[[v,F.value]])]),s("div",null,[a[11]||(a[11]=i("下：")),o(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[3]||(a[3]=e=>T.value=e),class:"inp"},null,512),[[v,T.value]])]),s("div",null,[a[12]||(a[12]=i("左：")),o(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[4]||(a[4]=e=>W.value=e),class:"inp"},null,512),[[v,W.value]])]),s("button",{onClick:A},"去边框")])):d("",!0),E.value.length>0?(t(),l("div",k,[s("div",null,[a[13]||(a[13]=i("x1：")),o(s("input",{type:"text","onUpdate:modelValue":a[5]||(a[5]=e=>J.value=e),class:"inp"},null,512),[[v,J.value]])]),s("div",null,[a[14]||(a[14]=i("y1：")),o(s("input",{type:"text","onUpdate:modelValue":a[6]||(a[6]=e=>K.value=e),class:"inp"},null,512),[[v,K.value]])]),s("div",null,[a[15]||(a[15]=i("x2：")),o(s("input",{type:"text","onUpdate:modelValue":a[7]||(a[7]=e=>M.value=e),class:"inp"},null,512),[[v,M.value]])]),s("div",null,[a[16]||(a[16]=i("y2：")),o(s("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=e=>Q.value=e),class:"inp"},null,512),[[v,Q.value]])]),s("button",{onClick:X},"去中间")])):d("",!0),S.value&&E.value.length>0?(t(),p(I,{key:2,image:E.value[0],max:"2",onPointsGet:B,onPointsClear:G},{default:u((()=>[2===q.value.length?(t(),l("div",j,[(t(!0),l(h,null,c(q.value,(e=>(t(),l("div",{key:e,class:"msg"},[s("i",null,r(e.x)+", "+r(e.y),1)])))),128)),s("button",{onClick:L},"复制")])):d("",!0)])),_:1},8,["image"])):d("",!0),n(w,{images:E.value},null,8,["images"]),R.value.length>0?(t(),p(b,{key:3,images:R.value},null,8,["images"])):d("",!0),n(x,{dataObj:V.value,onHistory:Y,onUse:Z,onUpdata:ee},null,8,["dataObj"])],64))}},[["__scopeId","data-v-12d5fd3c"]]);export{V as default};
