import{_ as e,r as t,o as a,c as l,a as i,w as n,b as s,e as u,v as o,l as h,f as c,F as d,i as v,t as r,h as g,p,j as m}from"./index-1beb5071.js";import{i as f,S as w,a as b,b as x,s as y}from"./ShowDataObj-ed625f89.js";const k=(e,t,a,l,i)=>new Promise(((n,s)=>{let[u,o,h,c,d]=l;if((0===e.length||t>e.length)&&s("error"),t===e.length){const e="image/jpeg",l=a.toDataURL(e,i);let s=l.length-`data:${e};base64,`.length;s=parseInt(s-s/4);const u=Date.parse(new Date)/100+t;return void n({size:s,type:e,timeStamp:u,base64:l})}const v=new Image;v.onload=()=>{const s=document.createElement("canvas");if(null===a){s.width=v.width+2*c,s.height=v.height+2*c;const e=s.getContext("2d");e.fillStyle=d,e.fillRect(0,0,s.width,s.height),e.drawImage(v,c,c)}else{const e=a.width-2*c,t=a.height-2*c,l=a.getContext("2d").getImageData(c,c,e,t);if(u)if(o){const t=e/v.width*v.height;s.width=a.width,s.height=a.height+t+h;const i=s.getContext("2d");i.fillStyle=d,i.fillRect(0,0,s.width,s.height),i.putImageData(l,c,c),i.drawImage(v,0,0,v.width,v.height,c,a.height-c+h,e,t)}else{const e=t/v.height*v.width;s.width=a.width+e+h,s.height=a.height;const i=s.getContext("2d");i.fillStyle=d,i.fillRect(0,0,s.width,s.height),i.putImageData(l,c,c),i.drawImage(v,0,0,v.width,v.height,a.width-c+h,c,e,t)}else if(o){const t=e>v.width?e:v.width;s.width=t+2*c,s.height=a.height+v.height+h;const i=s.getContext("2d");i.fillStyle=d,i.fillRect(0,0,s.width,s.height),i.putImageData(l,c,c),i.drawImage(v,c,a.height-c+h)}else{const e=t>v.height?a.height:v.height;s.width=a.width+v.width+h,s.height=e+2*c;const i=s.getContext("2d");i.fillStyle=d,i.fillRect(0,0,s.width,s.height),i.putImageData(l,c,c),i.drawImage(v,a.width-c+h,c)}}n(k(e,t+1,s,l,i))},v.src=e[t].base64})),I=e=>(p("data-v-5abdd456"),e=e(),m(),e),C={key:0},S={key:0,class:"setBox"},_=I((()=>s("span",{class:"inp_t"},"间隔：",-1))),D=I((()=>s("span",{class:"inp_t"},"边框：",-1))),U=["type"],j={class:"maxBox"},R=["src"],O={class:"selBox"},B=["value"],E=["onClick"],L={key:1,class:"res"},V=["src"],A=e({__name:"ImageMerge",setup(e){const p="imagemerge",m=t(f(p,[])),I=t([]);function A(e){I.value.push(e)}const $=t([]);function z(e){let t=parseInt(e.target.value);if(e.target.checked)$.value.push(t);else{let e=$.value;$.value=e.filter((e=>e!==t))}}const F=t(!0),G=t(!1),H=t("0"),M=t("0"),P=t("#ffffff"),q=t({});function J(){let e=[];if($.value.forEach((t=>{for(let a=0;a<I.value.length;a++){const l=I.value[a];if(l.timeStamp===t){e.push({...l});break}}})),0===e.length)return;let t=[G.value,F.value,parseInt(H.value),parseInt(M.value),P.value];k(e,0,null,t,.3).then((e=>{q.value=e}))}function K(){let{base64:e,type:t,timeStamp:a}=q.value,l=e.replace(`data:${t};base64,`,""),i=window.atob(l),n=new Uint8Array(i.length);for(let o=0;o<i.length;++o)n[o]=i.charCodeAt(o);let s=new Blob([n],{type:t}),u=document.createElement("a");u.href=URL.createObjectURL(s),u.download=a,u.target="_blank",u.click()}const N=t("color");function Q(){"color"===N.value?N.value="text":N.value="color"}function T(){let e={name:"",vertical:F.value,stretch:G.value,split:H.value,border:M.value,bgcolor:P.value};x(e,m.value)||(m.value.push(e),y(p,m.value))}function W(e){F.value=e.vertical,G.value=e.stretch,H.value=e.split,M.value=e.border,P.value=e.bgcolor}function X(e){y(p,e)}return(e,t)=>(a(),l(d,null,[i(w,{multiple:"",onGetImage:A},{default:n((()=>[I.value.length>0?(a(),l("div",C,[void 0!==q.value.base64?(a(),l("button",{key:0,class:"mr",onClick:t[0]||(t[0]=e=>I.value.push(q.value))},"暂存结果")):c("",!0),s("button",{class:"stretch mr",onClick:t[1]||(t[1]=e=>G.value=!G.value)},r(G.value?"拉伸":"不拉伸"),1),s("button",{class:"mr",onClick:t[2]||(t[2]=e=>F.value=!F.value)},r(F.value?"竖向":"横向"),1),s("button",{onClick:J},"合并")])):c("",!0)])),_:1}),I.value.length>0?(a(),l("div",S,[s("div",null,[_,u(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":t[3]||(t[3]=e=>H.value=e),class:"inp"},null,512),[[o,H.value]])]),s("div",null,[D,u(s("input",{type:"text",placeholder:"px","onUpdate:modelValue":t[4]||(t[4]=e=>M.value=e),class:"inp"},null,512),[[o,M.value]])]),s("div",null,[s("span",{onClick:Q,class:"inp_t"},"背景："),u(s("input",{type:N.value,"onUpdate:modelValue":t[5]||(t[5]=e=>P.value=e),class:"inp_c"},null,8,U),[[h,P.value]])])])):c("",!0),s("div",j,[(a(!0),l(d,null,v(I.value,(e=>(a(),l("div",{key:e.timeStamp,class:"imgBox"},[s("img",{src:e.base64},null,8,R),s("div",O,[s("input",{type:"checkbox",value:e.timeStamp,onChange:z},null,40,B),u(s("b",null,r($.value.indexOf(e.timeStamp)+1),513),[[g,-1!==$.value.indexOf(e.timeStamp)]]),s("button",{onClick:t=>function(e){let t=[];I.value.forEach((a=>{a.timeStamp!==e&&t.push({...a})})),I.value=t;let a=$.value;$.value=a.filter((t=>t!==e))}(e.timeStamp)},"删除",8,E)])])))),128))]),void 0!==q.value.base64?(a(),l("div",L,[s("img",{src:q.value.base64,onClick:K},null,8,V)])):c("",!0),i(b,{dataObj:m.value,onHistory:T,onUse:W,onUpdata:X},null,8,["dataObj"])],64))}},[["__scopeId","data-v-5abdd456"]]);export{A as default};
