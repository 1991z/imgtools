import{_ as e,r as a,o as t,c as l,a as n,w as s,b as i,d as u,e as o,v as h,t as d,f as v,g as c,F as m,h as r}from"./index-7793aea8.js";import{S as g}from"./SelectImage-2100df7f.js";import{S as p,D as f}from"./DownloadImage-2e5a1afd.js";import{i as w,S as b,a as I,s as y}from"./ShowDataObj-0bc172c5.js";const x={class:"doBox"},j={key:0,class:"setBox"},D="imagezip",N=e({__name:"ImageZip",setup(e){const N=a(w(D,[])),S=a([]);function U(e){S.value.push(e)}const _=a(30),k=a([]);function C(){k.value=[],S.value.forEach(((e,a)=>{((e,a,t)=>new Promise(((l,n)=>{if(void 0===e.base64)return void n("image no base64");if(a<0||a>.97)return void n("quality must be between 0 and 0.97");const s=new Image;s.onload=()=>{const e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0);const n="image/jpeg",i=e.toDataURL(n,a);let u=i.length-`data:${n};base64,`.length;u=parseInt(u-u/4);const o=Date.parse(new Date)/100+t;l({size:u,type:n,timeStamp:o,base64:i})},s.src=e.base64})))(e,_.value/100,a).then((e=>{k.value.push(e)})).catch((e=>{}))}))}const q=a(""),E=a(""),z=a(!1);function O(){k.value=[],S.value.forEach(((e,a)=>{((e,a,t,l,n,s)=>new Promise(((i,u)=>{if(void 0===e.base64)return void u("image no base64");if(n<0||n>.97)return void u("quality must be between 0 and 0.97");const o=parseInt(a),h=parseInt(t);if(isNaN(o)&&isNaN(h))return void u("width and height must be filled in one");if(o<10||h<10)return void u("width or height too small");const d=new Image;d.onload=()=>{const e=document.createElement("canvas");let a,t;if(isNaN(o))a=h/d.height*d.width,t=h;else if(isNaN(h))a=o,t=o/d.width*d.height;else if(l)a=o,t=h;else{let e=o/d.width,l=h/d.height;e<l?(a=o,t=e*d.height):(a=l*d.width,t=h)}e.width=a,e.height=t,e.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,a,t);const u="image/jpeg",v=e.toDataURL(u,n);let c=v.length-`data:${u};base64,`.length;c=parseInt(c-c/4);const m=Date.parse(new Date)/100+s;i({size:c,type:u,timeStamp:m,base64:v})},d.src=e.base64})))(e,q.value,E.value,z.value,_.value/100,a).then((e=>{k.value.push(e)})).catch((e=>{}))}))}function V(){let e={name:"",quality:_.value,width:q.value,height:E.value,stretch:z.value};I(e,N.value)||(N.value.push(e),y(D,N.value))}function B(e){_.value=e.quality,q.value=e.width,E.value=e.height,z.value=e.stretch}function L(e){y(D,e)}return(e,a)=>(t(),l(m,null,[n(g,{multiple:"",onGetImage:U},{default:s((()=>[o(i("div",x,[a[4]||(a[4]=u(" 压缩质量(0~97)：")),o(i("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=e=>_.value=e)},null,512),[[h,_.value]]),i("button",{onClick:C},"压缩")],512),[[r,S.value.length>0]])])),_:1}),S.value.length>0?(t(),l("div",j,[i("div",null,[a[5]||(a[5]=u("宽度：")),o(i("input",{type:"text",placeholder:"max","onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e)},null,512),[[h,q.value]])]),i("div",null,[a[6]||(a[6]=u("高度：")),o(i("input",{type:"text",placeholder:"max","onUpdate:modelValue":a[2]||(a[2]=e=>E.value=e)},null,512),[[h,E.value]])]),i("button",{onClick:a[3]||(a[3]=e=>z.value=!z.value),class:"stretch"},d(z.value?"拉伸":"不拉伸"),1),i("button",{onClick:O},"调整")])):v("",!0),n(p,{images:S.value},null,8,["images"]),k.value.length>0?(t(),c(f,{key:1,images:k.value},null,8,["images"])):v("",!0),n(b,{dataObj:N.value,onHistory:V,onUse:B,onUpdata:L},null,8,["dataObj"])],64))}},[["__scopeId","data-v-30c86557"]]);export{N as default};
