import{_ as t,o as e,c as i,f as n,k as a,p as o,j as s}from"./index-62ba23d4.js";const d=(t,e,i)=>{let n,a=0,o=0;void 0===i&&(i=(t,e)=>{}),"ontouchstart"in window?function(){function s(e){a=e.targetTouches[0].clientX,o=e.targetTouches[0].clientY,clearTimeout(n),n=setTimeout((()=>{let e=function(t){let e=0,i=0;for(;null!==t;)e+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;return{left:e,top:i}}(t);i(a-e.left,o-e.top)}),500),document.body.addEventListener("touchmove",c,{passive:!1}),window.addEventListener("touchmove",d),window.addEventListener("touchend",h)}function d(t){clearTimeout(n),e(t.targetTouches[0].clientX-a,t.targetTouches[0].clientY-o),a=t.targetTouches[0].clientX,o=t.targetTouches[0].clientY}function h(){document.body.removeEventListener("touchmove",c),window.removeEventListener("touchmove",d),window.removeEventListener("touchend",h)}function c(t){t.preventDefault()}t.addEventListener("touchstart",s)}():function(){function s(t){a=t.clientX,o=t.clientY,clearTimeout(n),n=setTimeout((()=>i(t.offsetX,t.offsetY)),500),window.addEventListener("mousemove",d),window.addEventListener("mouseup",h)}function d(t){clearTimeout(n),e(t.clientX-a,t.clientY-o),a=t.clientX,o=t.clientY}function h(){window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",h)}t.addEventListener("mousedown",s)}()};function h(t){let{canvas1:e,point:i,width:n,height:a}=t,o=e.getContext("2d");e.width=n,o.beginPath(),o.moveTo(i.x,0),o.lineTo(i.x,a),o.moveTo(0,i.y),o.lineTo(n,i.y),o.strokeStyle="red",o.stroke()}const c={props:{image:{type:Object,required:!0},max:{type:String,required:!0},drawP:{type:Array}},data:()=>({point:{x:-1,y:-1},points:[],msg:"",scaleW:1,scaleH:1,width:0,height:0,canvas0:null,canvas1:null,index:0}),mounted(){let t=new Image,e=document.getElementById("imgbg"),i=document.getElementById("canvas0"),n=document.getElementById("canvas1");t.onload=()=>{this.$data.scaleW=t.width/e.width,this.$data.scaleH=t.height/e.height,this.$data.width=e.width,this.$data.height=e.height,i.style.width=e.width+"px",i.style.height=e.height+"px",n.style.width=e.width+"px",n.style.height=e.height+"px",i.width=e.width,i.height=e.height,n.width=e.width,n.height=e.height,this.$data.canvas0=i,this.$data.canvas1=n},t.src=this.$props.image.base64,d(n,((t,e)=>{this.$data.point.x+=t,this.$data.point.y+=e,h(this.$data)}),((t,e)=>{this.$data.point.x=t,this.$data.point.y=e,h(this.$data)}))},methods:{addPoint(){let{x:t,y:e}={...this.$data.point},{width:i,height:n,points:a,index:o}=this.$data;if(t<0||e<0||t>i||e>n)return;a.length===o?this.$data.points.push({x:t,y:e}):this.$data.points[o]={x:t,y:e},this.$emit("okIndex",o);let s=parseInt(this.$props.max);if(this.$data.index=(o+s+1)%s,a.length===s){let{points:t,scaleW:e,scaleH:i}=this.$data;this.$emit("pointsGet",{points:t,scaleW:e,scaleH:i})}},clearPoints(){this.$data.points=[],this.$emit("pointsClear")}},watch:{points:{handler(){!function(t){let{canvas0:e,points:i,width:n,height:a}=t,o=e.getContext("2d");e.width=n,o.beginPath(),i.forEach((t=>{o.moveTo(t.x,0),o.lineTo(t.x,a),o.moveTo(0,t.y),o.lineTo(n,t.y)})),o.strokeStyle="green",o.stroke()}(this.$data)},deep:!0},point:{handler(){let{x:t,y:e}={...this.$data.point},{scaleW:i,scaleH:n}=this.$data;this.$emit("pointChange",{x:t,y:e,scaleW:i,scaleH:n})},deep:!0},drawP:{handler(t){let e=[],{scaleW:i,scaleH:n}=this.$data;t.forEach((t=>{let{x:a,y:o}={...t};e.push({x:a/i,y:o/n})})),this.$data.points=e;let a=parseInt(this.$props.max);this.$data.index=(e.length+a)%a},deep:!0}}},l=t=>(o("data-v-b8f2c379"),t=t(),s(),t),r={class:"doBox"},u={class:"btBox"},m={class:"doBox"},p=["src"],v=l((()=>n("canvas",{id:"canvas0"},null,-1))),g=l((()=>n("canvas",{id:"canvas1"},null,-1)));const w=t(c,[["render",function(t,o,s,d,h,c){return e(),i("div",r,[n("div",u,[n("button",{onClick:o[0]||(o[0]=(...t)=>c.clearPoints&&c.clearPoints(...t))},"清空"),n("button",{onClick:o[1]||(o[1]=(...t)=>c.addPoint&&c.addPoint(...t))},"确定"),a(t.$slots,"default",{},void 0,!0)]),n("div",m,[n("img",{id:"imgbg",src:s.image.base64},null,8,p),v,g])])}],["__scopeId","data-v-b8f2c379"]]),f=t=>{const e=document.createElement("input");e.setAttribute("value",t),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)};export{w as G,f as c,d as m};
