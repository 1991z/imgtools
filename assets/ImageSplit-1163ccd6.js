import{_ as e,o as t,c as a,b as l,p as n,j as i,r as s,a as o,w as u,e as d,v as h,f as v,F as c,i as r,g as p,d as m,t as g}from"./index-386cbb7b.js";import{i as y,S as w,a as x,b as f,s as b}from"./ShowDataObj-ea3d14db.js";import{S as $,D as I}from"./DownloadImage-8da82fd4.js";import{m as k,G as C,c as j}from"./copyText-ae4842c5.js";function D(e){let{myCanvas:t,img:a,x:l,y:n,wh:i,scale:s}=e,o=t.getContext("2d");t.width=i;let u=(1-s)*i/2;o.translate(u,u),o.scale(s,s),o.drawImage(a,l-i/2,n-i/2,i,i,0,0,i,i),o.beginPath(),o.moveTo(i/2,0),o.lineTo(i/2,i),o.moveTo(0,i/2),o.lineTo(i,i/2),o.strokeStyle="red",o.stroke()}const P={props:{image:{type:Object,required:!0},point:{type:Object,required:!0}},data:()=>({myCanvas:null,img:null,width:0,height:0,scale:1,wh:150,x:0,y:0}),mounted(){let e=document.getElementById("box"),t=document.getElementById("myCanvas"),a=20,l=20,{wh:n}=this.$data;e.style.top=a+"px",e.style.right=l+"px",t.style.width=n+"px",t.style.height=n+"px",t.width=n,t.height=n;let i=new Image,{x:s,y:o}=this.$props.point;i.onload=()=>{D(this.$data),this.$data.width=i.width,this.$data.height=i.height},i.src=this.$props.image.base64,this.$data.myCanvas=t,this.$data.img=i,this.$data.x=s,this.$data.y=o;let u=window.innerWidth-n,d=window.innerHeight-n-35;k(t,((t,n)=>{a+=n,l-=t,a<0&&(a=0),l<0&&(l=0),a>d&&(a=d),l>u&&(l=u),e.style.top=a+"px",e.style.right=l+"px"}),((e,t)=>{e<n/3?this.$data.x-=1:e>2*n/3&&(this.$data.x+=1),t<n/3?this.$data.y-=1:t>2*n/3&&(this.$data.y+=1),D(this.$data)}))},methods:{zoomOut(){4!==this.$data.scale&&(this.$data.scale+=.2,this.$data.scale>4&&(this.$data.scale=4),D(this.$data))},okPoint(){let{x:e,y:t,width:a,height:l}=this.$data;e<0&&(e=0),e>a&&(e=a),t<0&&(t=0),t>l&&(t=l),this.$emit("pointOk",{x:e,y:t})},reset(){this.$data.scale=1,D(this.$data)}},watch:{image:{handler(e){let{base64:t}=e;this.$data.img.src=t},deep:!0},point:{handler(e){let{x:t,y:a}=e;this.$data.x=t,this.$data.y=a,D(this.$data)},deep:!0}}},O={id:"box"},_=(e=>(n("data-v-c11470f0"),e=e(),i(),e))((()=>l("canvas",{id:"myCanvas"},null,-1))),N={id:"btBox"};const E=e(P,[["render",function(e,n,i,s,o,u){return t(),a("div",O,[_,l("div",N,[l("button",{onClick:n[0]||(n[0]=(...e)=>u.zoomOut&&u.zoomOut(...e))},"放大"),l("button",{onClick:n[1]||(n[1]=(...e)=>u.okPoint&&u.okPoint(...e))},"确定"),l("button",{onClick:n[2]||(n[2]=(...e)=>u.reset&&u.reset(...e))},"还原")])])}],["__scopeId","data-v-c11470f0"]]),S={key:0},U={key:1,class:"points"},z={class:"msgBox"},T={key:0},q=e({__name:"ImageSplit",setup(e){const n="imagesplit",i=s(y(n,[])),k=s([]);function D(e){k.value.push(e)}const P=s(!1);function O(){P.value=!P.value}const _=s("3"),N=s("3"),q=s({x:75,y:75}),B=s(!0);function H(){B.value=!B.value}function R(e){let{x:t,y:a,scaleW:l,scaleH:n}=e,i=parseInt(t*l),s=parseInt(a*n);q.value={x:i,y:s}}function G(e){let{scaleW:t,scaleH:a}=e,l=[];e.points.forEach((e=>{let n=parseInt(e.x*t),i=parseInt(e.y*a);l.push({x:n,y:i})})),V.value=l}const V=s([]),W=s(0);function L(e){W.value=e}function X(e){let t=W.value;V.value.length<3?(V.value.push(e),W.value=V.value.length%3):(V.value[t]=e,W.value=(t+4)%3)}function F(){V.value=[],W.value=0}const A=s("");function J(){let e=K(V.value[0],V.value[1],V.value[2]);A.value=e,j(e)}function K(e,t,a){let l=[e.x,t.x,a.x],n=[e.y,t.y,a.y];return l.sort(((e,t)=>e-t)),n.sort(((e,t)=>e-t)),`${l[0]},${n[0]},${l[1]-l[0]},${n[1]-n[0]},${l[2]-l[1]},${n[2]-n[1]}`}const M=s([]);function Q(){const e=parseInt(_.value),t=parseInt(N.value);let a="";if(3===V.value.length)a=K(V.value[0],V.value[1],V.value[2]);else{if(""===A.value)return isNaN(e)||isNaN(t)?void 0:(M.value=[],void k.value.forEach((a=>{((e,t,a,l)=>new Promise(((n,i)=>{if(void 0===e.base64)return void i("image no base64");if(t<1||a<1)return void i("row or col too small");if(l<0||l>.97)return void i("quality must be between 0 and 0.97");const s=new Image;s.onload=()=>{const e=document.createElement("canvas"),i=s.width/a,o=s.height/t;e.width=i,e.height=o;const u=e.getContext("2d"),d="image/jpeg";let h=[],v=0;for(let t=0;t<s.height;t+=o)for(let a=0;a<s.width;a+=i){u.clearRect(0,0,i,o),u.drawImage(s,a,t,i,o,0,0,i,o);const n=e.toDataURL(d,l);let c=n.length-`data:${d};base64,`.length;c=parseInt(c-c/4);const r=Date.parse(new Date)/100+v;h.push({size:c,type:d,timeStamp:r,base64:n}),v++}n(h)},s.src=e.base64})))(a,e,t,.3).then((e=>{let t=M.value;M.value=t.concat(e)})).catch((e=>{}))})));a=A.value}let l=a.split(",");6===l.length&&(M.value=[],k.value.forEach((a=>{((e,t,a,l,n)=>new Promise(((i,s)=>{if(void 0===e.base64)return void s("image no base64");if(6!==t.length)return void s("arr length is not 6");if(a<0||a>.97)return void s("quality must be between 0 and 0.97");let o=parseInt(t[0]),u=parseInt(t[1]),d=parseInt(t[2]),h=parseInt(t[3]),v=parseInt(t[4]),c=parseInt(t[5]);if(d<10||h<10)return void s("width or height too small");const r=new Image;r.onload=()=>{o<0&&(o=0),u<0&&(u=0),d>r.width&&(d=r.width),h>r.height&&(h=r.height),o+d>r.width&&(o=r.width-d),u+h>r.height&&(u=r.height-h);const e=document.createElement("canvas");e.width=d,e.height=h;const t=e.getContext("2d"),s="image/jpeg";let p=[],m=0,g=0;for(let i=u;i<=r.height-h&&(m++,void 0===l||isNaN(l)||!(m>l));i=i+h+c){g=0;for(let l=o;l<=r.width-d&&(g++,void 0===n||isNaN(n)||!(g>n));l=l+d+v){t.clearRect(0,0,d,h),t.drawImage(r,l,i,d,h,0,0,d,h);const n=e.toDataURL(s,a);let o=n.length-`data:${s};base64,`.length;o=parseInt(o-o/4);const u=Date.parse(new Date)/100+m*g;p.push({size:o,type:s,timeStamp:u,base64:n})}}i(p)},r.src=e.base64})))(a,l,.3,e,t).then((e=>{let t=M.value;M.value=t.concat(e)})).catch((e=>{}))})))}function Y(){M.value=[],k.value=[],P.value=!1}function Z(){let e={name:"",row:_.value,col:N.value,splitData:A.value,points:V.value};f(e,i.value)||(i.value.push(e),b(n,i.value))}function ee(e){_.value=e.row,N.value=e.col,A.value=e.splitData,V.value=e.points}function te(e){b(n,e)}return(e,n)=>(t(),a(c,null,[o(w,{onGetImage:D},{default:u((()=>[k.value.length>0?(t(),a("div",S,[l("button",{onClick:Y,class:"btX"},"删除"),l("button",{onClick:O,class:"btX"},"选点"),d(l("input",{type:"text",placeholder:"行","onUpdate:modelValue":n[0]||(n[0]=e=>_.value=e),class:"inp"},null,512),[[h,_.value]]),d(l("input",{type:"text",placeholder:"列","onUpdate:modelValue":n[1]||(n[1]=e=>N.value=e),class:"inp"},null,512),[[h,N.value]]),l("button",{onClick:Q},"分割")])):v("",!0)])),_:1}),k.value.length>0?d((t(),a("input",{key:0,type:"text",placeholder:"x,y,width,height,dx,dy","onUpdate:modelValue":n[2]||(n[2]=e=>A.value=e),id:"splitData"},null,512)),[[h,A.value]]):v("",!0),P.value&&3===V.value.length?(t(),a("div",U,[(t(!0),a(c,null,r(V.value,((e,n)=>(t(),a("div",{key:e},[m(" p"+g(n+1)+": ",1),l("i",null,g(e.x)+", "+g(e.y),1)])))),128)),l("button",{onClick:J},"复制")])):v("",!0),P.value?v("",!0):(t(),p($,{key:2,images:k.value},null,8,["images"])),P.value&&k.value.length>0?(t(),p(C,{key:3,drawP:V.value,indexC:W.value,image:k.value[0],max:"3",onPointsGet:G,onPointChange:R,onOkIndex:L,onPointsClear:F},{default:u((()=>[l("div",z,[W.value>-1?(t(),a("p",T,[m("当前 "),l("i",null,"p"+g(W.value+1),1)])):v("",!0),l("button",{onClick:H},"放大镜"),m(" 确定点位 ")])])),_:1},8,["drawP","indexC","image"])):v("",!0),P.value&&B.value?(t(),p(E,{key:4,image:k.value[0],point:q.value,onPointOk:X},null,8,["image","point"])):v("",!0),M.value.length>0?(t(),p(I,{key:5,images:M.value},null,8,["images"])):v("",!0),o(x,{dataObj:i.value,onHistory:Z,onUse:ee,onUpdata:te},null,8,["dataObj"])],64))}},[["__scopeId","data-v-ebd4e0b1"]]);export{q as default};
