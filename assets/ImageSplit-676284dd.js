import{_ as e,o as t,c as a,b as l,r as n,a as i,w as s,e as o,v as u,f as d,F as h,i as v,g as r,d as c,t as p}from"./index-7793aea8.js";import{S as m}from"./SelectImage-2100df7f.js";import{S as g,D as y}from"./DownloadImage-2e5a1afd.js";import{m as w,G as x,c as f}from"./copyText-de95a3cc.js";import{i as b,S as $,a as I,s as k}from"./ShowDataObj-0bc172c5.js";function C(e){let{myCanvas:t,img:a,x:l,y:n,wh:i,scale:s}=e,o=t.getContext("2d");t.width=i;let u=(1-s)*i/2;o.translate(u,u),o.scale(s,s),o.drawImage(a,l-i/2,n-i/2,i,i,0,0,i,i),o.beginPath(),o.moveTo(i/2,0),o.lineTo(i/2,i),o.moveTo(0,i/2),o.lineTo(i,i/2),o.strokeStyle="red",o.stroke()}const j={id:"box"},D={id:"btBox"};const P=e({props:{image:{type:Object,required:!0},point:{type:Object,required:!0}},data:()=>({myCanvas:null,img:null,width:0,height:0,scale:1,wh:150,x:0,y:0}),mounted(){let e=document.getElementById("box"),t=document.getElementById("myCanvas"),a=20,l=20,{wh:n}=this.$data;e.style.top=a+"px",e.style.right=l+"px",t.style.width=n+"px",t.style.height=n+"px",t.width=n,t.height=n;let i=new Image,{x:s,y:o}=this.$props.point;i.onload=()=>{C(this.$data),this.$data.width=i.width,this.$data.height=i.height},i.src=this.$props.image.base64,this.$data.myCanvas=t,this.$data.img=i,this.$data.x=s,this.$data.y=o;let u=window.innerWidth-n,d=window.innerHeight-n-35;w(t,((t,n)=>{a+=n,l-=t,a<0&&(a=0),l<0&&(l=0),a>d&&(a=d),l>u&&(l=u),e.style.top=a+"px",e.style.right=l+"px"}),((e,t)=>{e<n/3?this.$data.x-=1:e>2*n/3&&(this.$data.x+=1),t<n/3?this.$data.y-=1:t>2*n/3&&(this.$data.y+=1),C(this.$data)}))},methods:{zoomOut(){4!==this.$data.scale&&(this.$data.scale+=.2,this.$data.scale>4&&(this.$data.scale=4),C(this.$data))},okPoint(){let{x:e,y:t,width:a,height:l}=this.$data;e<0&&(e=0),e>a&&(e=a),t<0&&(t=0),t>l&&(t=l),this.$emit("pointOk",{x:e,y:t})},reset(){this.$data.scale=1,C(this.$data)}},watch:{image:{handler(e){let{base64:t}=e;this.$data.img.src=t},deep:!0},point:{handler(e){let{x:t,y:a}=e;this.$data.x=t,this.$data.y=a,C(this.$data)},deep:!0}}},[["render",function(e,n,i,s,o,u){return t(),a("div",j,[n[3]||(n[3]=l("canvas",{id:"myCanvas"},null,-1)),l("div",D,[l("button",{onClick:n[0]||(n[0]=(...e)=>u.zoomOut&&u.zoomOut(...e))},"放大"),l("button",{onClick:n[1]||(n[1]=(...e)=>u.okPoint&&u.okPoint(...e))},"确定"),l("button",{onClick:n[2]||(n[2]=(...e)=>u.reset&&u.reset(...e))},"还原")])])}],["__scopeId","data-v-c11470f0"]]),O={key:0},S={key:1,class:"points"},_={class:"msgBox"},N={key:0},E="imagesplit",U=e({__name:"ImageSplit",setup(e){const w=n(b(E,[])),C=n([]);function j(e){C.value.push(e)}const D=n(!1);function U(){D.value=!D.value}const z=n("3"),T=n("3"),q=n({x:75,y:75}),B=n(!0);function H(){B.value=!B.value}function R(e){let{x:t,y:a,scaleW:l,scaleH:n}=e,i=parseInt(t*l),s=parseInt(a*n);q.value={x:i,y:s}}function G(e){let{scaleW:t,scaleH:a}=e,l=[];e.points.forEach((e=>{let n=parseInt(e.x*t),i=parseInt(e.y*a);l.push({x:n,y:i})})),V.value=l}const V=n([]),W=n(0);function L(e){W.value=e}function X(e){let t=W.value;V.value.length<3?(V.value.push(e),W.value=V.value.length%3):(V.value[t]=e,W.value=(t+4)%3)}function F(){V.value=[],W.value=0}const A=n("");function J(){let e=K(V.value[0],V.value[1],V.value[2]);A.value=e,f(e)}function K(e,t,a){let l=[e.x,t.x,a.x],n=[e.y,t.y,a.y];return l.sort(((e,t)=>e-t)),n.sort(((e,t)=>e-t)),`${l[0]},${n[0]},${l[1]-l[0]},${n[1]-n[0]},${l[2]-l[1]},${n[2]-n[1]}`}const M=n([]);function Q(){const e=parseInt(z.value),t=parseInt(T.value);let a="";if(3===V.value.length)a=K(V.value[0],V.value[1],V.value[2]);else{if(""===A.value)return isNaN(e)||isNaN(t)?void 0:(M.value=[],void C.value.forEach((a=>{((e,t,a,l)=>new Promise(((n,i)=>{if(void 0===e.base64)return void i("image no base64");if(t<1||a<1)return void i("row or col too small");if(l<0||l>.97)return void i("quality must be between 0 and 0.97");const s=new Image;s.onload=()=>{const e=document.createElement("canvas"),i=s.width/a,o=s.height/t;e.width=i,e.height=o;const u=e.getContext("2d"),d="image/jpeg";let h=[],v=0;for(let t=0;t<s.height;t+=o)for(let a=0;a<s.width;a+=i){u.clearRect(0,0,i,o),u.drawImage(s,a,t,i,o,0,0,i,o);const n=e.toDataURL(d,l);let r=n.length-`data:${d};base64,`.length;r=parseInt(r-r/4);const c=Date.parse(new Date)/100+v;h.push({size:r,type:d,timeStamp:c,base64:n}),v++}n(h)},s.src=e.base64})))(a,e,t,.3).then((e=>{let t=M.value;M.value=t.concat(e)})).catch((e=>{}))})));a=A.value}let l=a.split(",");6===l.length&&(M.value=[],C.value.forEach((a=>{((e,t,a,l,n)=>new Promise(((i,s)=>{if(void 0===e.base64)return void s("image no base64");if(6!==t.length)return void s("arr length is not 6");if(a<0||a>.97)return void s("quality must be between 0 and 0.97");let o=parseInt(t[0]),u=parseInt(t[1]),d=parseInt(t[2]),h=parseInt(t[3]),v=parseInt(t[4]),r=parseInt(t[5]);if(d<10||h<10)return void s("width or height too small");const c=new Image;c.onload=()=>{o<0&&(o=0),u<0&&(u=0),d>c.width&&(d=c.width),h>c.height&&(h=c.height),o+d>c.width&&(o=c.width-d),u+h>c.height&&(u=c.height-h);const e=document.createElement("canvas");e.width=d,e.height=h;const t=e.getContext("2d"),s="image/jpeg";let p=[],m=0,g=0;for(let i=u;i<=c.height-h&&(m++,void 0===l||isNaN(l)||!(m>l));i=i+h+r){g=0;for(let l=o;l<=c.width-d&&(g++,void 0===n||isNaN(n)||!(g>n));l=l+d+v){t.clearRect(0,0,d,h),t.drawImage(c,l,i,d,h,0,0,d,h);const n=e.toDataURL(s,a);let o=n.length-`data:${s};base64,`.length;o=parseInt(o-o/4);const u=Date.parse(new Date)/100+m*g;p.push({size:o,type:s,timeStamp:u,base64:n})}}i(p)},c.src=e.base64})))(a,l,.3,e,t).then((e=>{let t=M.value;M.value=t.concat(e)})).catch((e=>{}))})))}function Y(){M.value=[],C.value=[],D.value=!1}function Z(){let e={name:"",row:z.value,col:T.value,splitData:A.value,points:V.value};I(e,w.value)||(w.value.push(e),k(E,w.value))}function ee(e){z.value=e.row,T.value=e.col,A.value=e.splitData,V.value=e.points}function te(e){k(E,e)}return(e,n)=>(t(),a(h,null,[i(m,{onGetImage:j},{default:s((()=>[C.value.length>0?(t(),a("div",O,[l("button",{onClick:Y,class:"btX"},"删除"),l("button",{onClick:U,class:"btX"},"选点"),o(l("input",{type:"text",placeholder:"行","onUpdate:modelValue":n[0]||(n[0]=e=>z.value=e),class:"inp"},null,512),[[u,z.value]]),o(l("input",{type:"text",placeholder:"列","onUpdate:modelValue":n[1]||(n[1]=e=>T.value=e),class:"inp"},null,512),[[u,T.value]]),l("button",{onClick:Q},"分割")])):d("",!0)])),_:1}),C.value.length>0?o((t(),a("input",{key:0,type:"text",placeholder:"x,y,width,height,dx,dy","onUpdate:modelValue":n[2]||(n[2]=e=>A.value=e),id:"splitData"},null,512)),[[u,A.value]]):d("",!0),D.value&&3===V.value.length?(t(),a("div",S,[(t(!0),a(h,null,v(V.value,((e,n)=>(t(),a("div",{key:e},[c(" p"+p(n+1)+": ",1),l("i",null,p(e.x)+", "+p(e.y),1)])))),128)),l("button",{onClick:J},"复制")])):d("",!0),D.value?d("",!0):(t(),r(g,{key:2,images:C.value},null,8,["images"])),D.value&&C.value.length>0?(t(),r(x,{key:3,drawP:V.value,indexC:W.value,image:C.value[0],max:"3",onPointsGet:G,onPointChange:R,onOkIndex:L,onPointsClear:F},{default:s((()=>[l("div",_,[W.value>-1?(t(),a("p",N,[n[3]||(n[3]=c("当前 ")),l("i",null,"p"+p(W.value+1),1)])):d("",!0),l("button",{onClick:H},"放大镜"),n[4]||(n[4]=c(" 确定点位 "))])])),_:1},8,["drawP","indexC","image"])):d("",!0),D.value&&B.value?(t(),r(P,{key:4,image:C.value[0],point:q.value,onPointOk:X},null,8,["image","point"])):d("",!0),M.value.length>0?(t(),r(y,{key:5,images:M.value},null,8,["images"])):d("",!0),i($,{dataObj:w.value,onHistory:Z,onUse:ee,onUpdata:te},null,8,["dataObj"])],64))}},[["__scopeId","data-v-ebd4e0b1"]]);export{U as default};
