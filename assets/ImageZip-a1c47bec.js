import{_ as e,r as a,o as t,c as l,a as n,w as s,b as i,d as u,e as o,v as h,t as d,f as v,g as c,F as r,h as m}from"./index-386cbb7b.js";import{i as g,S as p,a as w,b,s as f}from"./ShowDataObj-ea3d14db.js";import{S as y,D as I}from"./DownloadImage-8da82fd4.js";const x={class:"doBox"},D={key:0,class:"setBox"},j=e({__name:"ImageZip",setup(e){const j="imagezip",N=a(g(j,[])),U=a([]);function _(e){U.value.push(e)}const k=a(30),C=a([]);function S(){C.value=[],U.value.forEach(((e,a)=>{((e,a,t)=>new Promise(((l,n)=>{if(void 0===e.base64)return void n("image no base64");if(a<0||a>.97)return void n("quality must be between 0 and 0.97");const s=new Image;s.onload=()=>{const e=document.createElement("canvas");e.width=s.width,e.height=s.height,e.getContext("2d").drawImage(s,0,0);const n="image/jpeg",i=e.toDataURL(n,a);let u=i.length-`data:${n};base64,`.length;u=parseInt(u-u/4);const o=Date.parse(new Date)/100+t;l({size:u,type:n,timeStamp:o,base64:i})},s.src=e.base64})))(e,k.value/100,a).then((e=>{C.value.push(e)})).catch((e=>{}))}))}const q=a(""),E=a(""),z=a(!1);function O(){C.value=[],U.value.forEach(((e,a)=>{((e,a,t,l,n,s)=>new Promise(((i,u)=>{if(void 0===e.base64)return void u("image no base64");if(n<0||n>.97)return void u("quality must be between 0 and 0.97");const o=parseInt(a),h=parseInt(t);if(isNaN(o)&&isNaN(h))return void u("width and height must be filled in one");if(o<10||h<10)return void u("width or height too small");const d=new Image;d.onload=()=>{const e=document.createElement("canvas");let a,t;if(isNaN(o))a=h/d.height*d.width,t=h;else if(isNaN(h))a=o,t=o/d.width*d.height;else if(l)a=o,t=h;else{let e=o/d.width,l=h/d.height;e<l?(a=o,t=e*d.height):(a=l*d.width,t=h)}e.width=a,e.height=t,e.getContext("2d").drawImage(d,0,0,d.width,d.height,0,0,a,t);const u="image/jpeg",v=e.toDataURL(u,n);let c=v.length-`data:${u};base64,`.length;c=parseInt(c-c/4);const r=Date.parse(new Date)/100+s;i({size:c,type:u,timeStamp:r,base64:v})},d.src=e.base64})))(e,q.value,E.value,z.value,k.value/100,a).then((e=>{C.value.push(e)})).catch((e=>{}))}))}function V(){let e={name:"",quality:k.value,width:q.value,height:E.value,stretch:z.value};b(e,N.value)||(N.value.push(e),f(j,N.value))}function B(e){k.value=e.quality,q.value=e.width,E.value=e.height,z.value=e.stretch}function L(e){f(j,e)}return(e,a)=>(t(),l(r,null,[n(p,{multiple:"",onGetImage:_},{default:s((()=>[o(i("div",x,[u(" 压缩质量(0~97)："),o(i("input",{type:"number","onUpdate:modelValue":a[0]||(a[0]=e=>k.value=e)},null,512),[[h,k.value]]),i("button",{onClick:S},"压缩")],512),[[m,U.value.length>0]])])),_:1}),U.value.length>0?(t(),l("div",D,[i("div",null,[u("宽度："),o(i("input",{type:"text",placeholder:"max","onUpdate:modelValue":a[1]||(a[1]=e=>q.value=e)},null,512),[[h,q.value]])]),i("div",null,[u("高度："),o(i("input",{type:"text",placeholder:"max","onUpdate:modelValue":a[2]||(a[2]=e=>E.value=e)},null,512),[[h,E.value]])]),i("button",{onClick:a[3]||(a[3]=e=>z.value=!z.value),class:"stretch"},d(z.value?"拉伸":"不拉伸"),1),i("button",{onClick:O},"调整")])):v("",!0),n(y,{images:U.value},null,8,["images"]),C.value.length>0?(t(),c(I,{key:1,images:C.value},null,8,["images"])):v("",!0),n(w,{dataObj:N.value,onHistory:V,onUse:B,onUpdata:L},null,8,["dataObj"])],64))}},[["__scopeId","data-v-30c86557"]]);export{j as default};
