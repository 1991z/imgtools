import{_ as e,r as t,o as a,c as n,a as l,w as s,b as o,d as i,F as u,f as r,e as h,h as c,i as v,t as g}from"./index-62ba23d4.js";import{S as m}from"./SelectImage-a77911a7.js";import{S as d,D as p}from"./DownloadImage-9866353f.js";import{G as f,c as y}from"./copyText-71e9c0a7.js";const x={key:0},w={key:0,class:"msgBox"},I=e({__name:"ImageCrop",setup(e){const I=t([]);function b(e){I.value.push(e)}const k=t(!1);function _(){k.value=!k.value}const j=t([]),C=t("");function D(e){let{scaleW:t,scaleH:a}=e,n=[];e.points.forEach((e=>{let l=parseInt(e.x*t),s=parseInt(e.y*a);n.push({x:l,y:s})})),j.value=n}function S(){j.value=[]}function E(){let e=G(j.value[0],j.value[1]);C.value=e,y(e)}function G(e,t){let a,n,l,s;return e.x<t.x?(a=e.x,l=t.x-e.x):(a=t.x,l=e.x-t.x),e.y<t.y?(n=e.y,s=t.y-e.y):(n=t.y,s=e.y-t.y),[a,n,l,s].join(",")}const P=t([]);function U(){if(2!==j.value.length)return;let e;e=""===C.value?G(j.value[0],j.value[1]):C.value;let t=e.split(",");4===t.length&&(P.value=[],I.value.forEach(((e,a)=>{((e,t,a,n)=>new Promise(((l,s)=>{if(void 0===e.base64)return void s("image no base64");if(4!==t.length)return void s("arr length is not 4");if(a<0||a>.97)return void s("quality must be between 0 and 0.97");let o=parseInt(t[0]),i=parseInt(t[1]),u=parseInt(t[2]),r=parseInt(t[3]);if(u<10||r<10)return void s("width or height too small");const h=new Image;h.onload=()=>{o<0&&(o=0),i<0&&(i=0),u>h.width&&(u=h.width),r>h.height&&(r=h.height),o+u>h.width&&(o=h.width-u),i+r>h.height&&(i=h.height-r);const e=document.createElement("canvas");e.width=u,e.height=r,e.getContext("2d").drawImage(h,o,i,u,r,0,0,u,r);const t="image/jpeg",s=e.toDataURL(t,a);let c=s.length-`data:${t};base64,`.length;c=parseInt(c-c/4);const v=Date.parse(new Date)/100+n;l({size:c,type:t,timeStamp:v,base64:s})},h.src=e.base64})))(e,t,.3,a).then((e=>{P.value.push(e)})).catch((e=>{}))})))}return(e,t)=>(a(),n(u,null,[l(m,{multiple:"",onGetImage:b},{default:s((()=>[I.value.length>0?(a(),n("div",x,[r("button",{onClick:_},"选点"),h(r("input",{type:"text",placeholder:"x,y,width,height","onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),id:"cropData"},null,512),[[c,C.value]]),r("button",{onClick:U},"裁剪")])):i("",!0)])),_:1}),k.value&&I.value.length>0?(a(),o(f,{key:0,image:I.value[0],max:"2",onPointsGet:D,onPointsClear:S},{default:s((()=>[2===j.value.length?(a(),n("div",w,[(a(!0),n(u,null,v(j.value,(e=>(a(),n("div",{key:e,class:"msg"},[r("i",null,g(e.x)+", "+g(e.y),1)])))),128)),r("button",{onClick:E},"复制")])):i("",!0)])),_:1},8,["image"])):i("",!0),l(d,{images:I.value},null,8,["images"]),P.value.length>0?(a(),o(p,{key:1,images:P.value},null,8,["images"])):i("",!0)],64))}},[["__scopeId","data-v-1996d68f"]]);export{I as default};
