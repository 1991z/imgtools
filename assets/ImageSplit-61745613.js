import{_ as e,o as t,c as a,f as l,p as n,j as i,r as s,a as o,w as u,e as d,h,d as r,F as c,i as v,b as p,g as m,t as g}from"./index-62ba23d4.js";import{S as y}from"./SelectImage-a77911a7.js";import{S as x,D as w}from"./DownloadImage-9866353f.js";import{m as f,G as $,c as b}from"./copyText-71e9c0a7.js";function I(e){let{myCanvas:t,img:a,x:l,y:n,wh:i,scale:s}=e,o=t.getContext("2d");t.width=i;let u=(1-s)*i/2;o.translate(u,u),o.scale(s,s),o.drawImage(a,l-i/2,n-i/2,i,i,0,0,i,i),o.beginPath(),o.moveTo(i/2,0),o.lineTo(i/2,i),o.moveTo(0,i/2),o.lineTo(i,i/2),o.strokeStyle="red",o.stroke()}const k={props:{image:{type:Object,required:!0},point:{type:Object,required:!0}},data:()=>({myCanvas:null,img:null,scale:1,wh:150,x:0,y:0}),mounted(){let e=document.getElementById("box"),t=document.getElementById("myCanvas"),a=20,l=20,{wh:n}=this.$data;e.style.top=a+"px",e.style.right=l+"px",t.style.width=n+"px",t.style.height=n+"px",t.width=n,t.height=n;let i=new Image,{x:s,y:o}=this.$props.point;i.onload=()=>{I(this.$data)},i.src=this.$props.image.base64,this.$data.myCanvas=t,this.$data.img=i,this.$data.x=s,this.$data.y=o;let u=window.innerWidth-n,d=window.innerHeight-n-35;f(t,((t,n)=>{a+=n,l-=t,a<0&&(a=0),l<0&&(l=0),a>d&&(a=d),l>u&&(l=u),e.style.top=a+"px",e.style.right=l+"px"}),((e,t)=>{e<n/3?this.$data.x-=1:e>2*n/3&&(this.$data.x+=1),t<n/3?this.$data.y-=1:t>2*n/3&&(this.$data.y+=1),I(this.$data)}))},methods:{zoomOut(){4!==this.$data.scale&&(this.$data.scale+=.2,this.$data.scale>4&&(this.$data.scale=4),I(this.$data))},okPoint(){let{x:e,y:t}=this.$data;this.$emit("pointOk",{x:e,y:t})},reset(){this.$data.scale=1,I(this.$data)}},watch:{image:{handler(e){let{base64:t}=e;this.$data.img.src=t},deep:!0},point:{handler(e){let{x:t,y:a}=e;this.$data.x=t,this.$data.y=a,I(this.$data)},deep:!0}}},C={id:"box"},P=(e=>(n("data-v-719d182a"),e=e(),i(),e))((()=>l("canvas",{id:"myCanvas"},null,-1))),j={id:"btBox"};const D=e(k,[["render",function(e,n,i,s,o,u){return t(),a("div",C,[P,l("div",j,[l("button",{onClick:n[0]||(n[0]=(...e)=>u.zoomOut&&u.zoomOut(...e))},"放大"),l("button",{onClick:n[1]||(n[1]=(...e)=>u.okPoint&&u.okPoint(...e))},"确定"),l("button",{onClick:n[2]||(n[2]=(...e)=>u.reset&&u.reset(...e))},"还原")])])}],["__scopeId","data-v-719d182a"]]),_={key:0},N={key:1,class:"points"},O={class:"msgBox"},S={key:0},E=e({__name:"ImageSplit",setup(e){const n=s([]);function i(e){n.value.push(e)}const f=s(!1);function I(){f.value=!f.value}const k=s("3"),C=s("3"),P=s({x:75,y:75}),j=s(!0);function E(){j.value=!j.value}function z(e){let{x:t,y:a,scaleW:l,scaleH:n}=e,i=parseInt(t*l),s=parseInt(a*n);P.value={x:i,y:s}}const T=s([]),U=s(-1);function q(e){U.value=e}function B(e){let t=U.value;T.value.length<3?(T.value.push(e),U.value=T.value.length%3):(T.value[t]=e,U.value=(t+4)%3)}function R(){T.value=[],U.value=-1}const V=s("");function G(){let e=H(T.value[0],T.value[1],T.value[2]);V.value=e,b(e)}function H(e,t,a){let l=[e.x,t.x,a.x],n=[e.y,t.y,a.y];return l.sort(((e,t)=>e-t)),n.sort(((e,t)=>e-t)),`${l[0]},${n[0]},${l[1]-l[0]},${n[1]-n[0]},${l[2]-l[1]},${n[2]-n[1]}`}const L=s([]);function W(){const e=parseInt(k.value),t=parseInt(C.value);let a="";if(3===T.value.length)a=H(T.value[0],T.value[1],T.value[2]);else{if(""===V.value)return isNaN(e)||isNaN(t)?void 0:(L.value=[],void n.value.forEach((a=>{((e,t,a,l)=>new Promise(((n,i)=>{if(void 0===e.base64)return void i("image no base64");if(t<1||a<1)return void i("row or col too small");if(l<0||l>.97)return void i("quality must be between 0 and 0.97");const s=new Image;s.onload=()=>{const e=document.createElement("canvas"),i=s.width/a,o=s.height/t;e.width=i,e.height=o;const u=e.getContext("2d"),d="image/jpeg";let h=[],r=0;for(let t=0;t<s.height;t+=o)for(let a=0;a<s.width;a+=i){u.clearRect(0,0,i,o),u.drawImage(s,a,t,i,o,0,0,i,o);const n=e.toDataURL(d,l);let c=n.length-`data:${d};base64,`.length;c=parseInt(c-c/4);const v=Date.parse(new Date)/100+r;h.push({size:c,type:d,timeStamp:v,base64:n}),r++}n(h)},s.src=e.base64})))(a,e,t,.3).then((e=>{let t=L.value;L.value=t.concat(e)})).catch((e=>{}))})));a=V.value}let l=a.split(",");6===l.length&&(L.value=[],n.value.forEach((a=>{((e,t,a,l,n)=>new Promise(((i,s)=>{if(void 0===e.base64)return void s("image no base64");if(6!==t.length)return void s("arr length is not 6");if(a<0||a>.97)return void s("quality must be between 0 and 0.97");let o=parseInt(t[0]),u=parseInt(t[1]),d=parseInt(t[2]),h=parseInt(t[3]),r=parseInt(t[4]),c=parseInt(t[5]);if(d<10||h<10)return void s("width or height too small");const v=new Image;v.onload=()=>{o<0&&(o=0),u<0&&(u=0),d>v.width&&(d=v.width),h>v.height&&(h=v.height),o+d>v.width&&(o=v.width-d),u+h>v.height&&(u=v.height-h);const e=document.createElement("canvas");e.width=d,e.height=h;const t=e.getContext("2d"),s="image/jpeg";let p=[],m=0,g=0;for(let i=u;i<=v.height-d&&(m++,void 0===l||isNaN(l)||!(m>l));i=i+h+c){g=0;for(let l=o;l<=v.width-d&&(g++,void 0===n||isNaN(n)||!(g>n));l=l+d+r){t.clearRect(0,0,d,h),t.drawImage(v,l,i,d,h,0,0,d,h);const n=e.toDataURL(s,a);let o=n.length-`data:${s};base64,`.length;o=parseInt(o-o/4);const u=Date.parse(new Date)/100+m*g;p.push({size:o,type:s,timeStamp:u,base64:n})}}i(p)},v.src=e.base64})))(a,l,.3,e,t).then((e=>{let t=L.value;L.value=t.concat(e)})).catch((e=>{}))})))}function X(){L.value=[],n.value=[]}return(e,s)=>(t(),a(c,null,[o(y,{onGetImage:i},{default:u((()=>[n.value.length>0?(t(),a("div",_,[l("button",{onClick:X,class:"btX"},"删除"),l("button",{onClick:I,class:"btX"},"选点"),d(l("input",{type:"text",placeholder:"行","onUpdate:modelValue":s[0]||(s[0]=e=>k.value=e),class:"inp"},null,512),[[h,k.value]]),d(l("input",{type:"text",placeholder:"列","onUpdate:modelValue":s[1]||(s[1]=e=>C.value=e),class:"inp"},null,512),[[h,C.value]]),l("button",{onClick:W},"分割")])):r("",!0)])),_:1}),n.value.length>0?d((t(),a("input",{key:0,type:"text",placeholder:"x,y,width,height,dx,dy","onUpdate:modelValue":s[2]||(s[2]=e=>V.value=e),id:"splitData"},null,512)),[[h,V.value]]):r("",!0),f.value&&3===T.value.length?(t(),a("div",N,[(t(!0),a(c,null,v(T.value,((e,n)=>(t(),a("div",{key:e},[m(" p"+g(n+1)+": ",1),l("i",null,g(e.x)+", "+g(e.y),1)])))),128)),l("button",{onClick:G},"复制")])):r("",!0),f.value?r("",!0):(t(),p(x,{key:2,images:n.value},null,8,["images"])),f.value&&n.value.length>0?(t(),p($,{key:3,drawP:T.value,image:n.value[0],max:"3",onPointChange:z,onOkIndex:q,onPointsClear:R},{default:u((()=>[l("div",O,[U.value>-1?(t(),a("p",S,[m("当前 "),l("i",null,"p"+g(U.value+1),1)])):r("",!0),l("button",{onClick:E},"放大镜"),m(" 确定点位 ")])])),_:1},8,["drawP","image"])):r("",!0),f.value&&j.value?(t(),p(D,{key:4,image:n.value[0],point:P.value,onPointOk:B},null,8,["image","point"])):r("",!0),L.value.length>0?(t(),p(w,{key:5,images:L.value},null,8,["images"])):r("",!0)],64))}},[["__scopeId","data-v-f34a2edf"]]);export{E as default};
