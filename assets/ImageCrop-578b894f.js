import{_ as e,r as a,o as t,c as l,a as n,w as s,b as u,d as o,e as i,v,f as p,g as r,F as c,i as d,t as h}from"./index-6e386582.js";import{i as m,S as g,a as f,b as x,s as y}from"./ShowDataObj-be0a3a30.js";import{S as b,D as w}from"./DownloadImage-30068b6b.js";import{G as I,c as D}from"./copyText-bb66aff5.js";const k={key:0},j={key:0,class:"setBox"},U={key:0,class:"msgBox"},C=e({__name:"ImageCrop",setup(e){const C="imagecrop",N=a(m(C,[])),_=a([]);function E(e){_.value.push(e)}const S=a(!1);function V(){S.value=!S.value}const P=a([]),G=a("");function O(e){let{scaleW:a,scaleH:t}=e,l=[];e.points.forEach((e=>{let n=parseInt(e.x*a),s=parseInt(e.y*t);l.push({x:n,y:s})})),P.value=l}function q(){P.value=[]}function z(){let e=B(P.value[0],P.value[1]);G.value=e,D(e)}function B(e,a){let t,l,n,s;return e.x<a.x?(t=e.x,n=a.x-e.x):(t=a.x,n=e.x-a.x),e.y<a.y?(l=e.y,s=a.y-e.y):(l=a.y,s=e.y-a.y),[t,l,n,s]}const H=a([]);function L(){let e;if(""===G.value){if(2!==P.value.length)return;e=B(P.value[0],P.value[1])}else e=G.value.split(",");4===e.length&&(H.value=[],_.value.forEach(((a,t)=>{((e,a,t,l)=>new Promise(((n,s)=>{if(void 0===e.base64)return void s("image no base64");if(4!==a.length)return void s("arr length is not 4");if(t<0||t>.97)return void s("quality must be between 0 and 0.97");let u=parseInt(a[0]),o=parseInt(a[1]),i=parseInt(a[2]),v=parseInt(a[3]);if(i<10||v<10)return void s("width or height too small");const p=new Image;p.onload=()=>{u<0&&(u=0),o<0&&(o=0),i>p.width&&(i=p.width),v>p.height&&(v=p.height),u+i>p.width&&(u=p.width-i),o+v>p.height&&(o=p.height-v);const e=document.createElement("canvas");e.width=i,e.height=v,e.getContext("2d").drawImage(p,u,o,i,v,0,0,i,v);const a="image/jpeg",s=e.toDataURL(a,t);let r=s.length-`data:${a};base64,`.length;r=parseInt(r-r/4);const c=Date.parse(new Date)/100+l;n({size:r,type:a,timeStamp:c,base64:s})},p.src=e.base64})))(a,e,.3,t).then((e=>{H.value.push(e)})).catch((e=>{}))})))}const R=a(0),$=a(0),F=a(0),T=a(0);function W(){let e=parseInt(R.value),a=parseInt($.value),t=parseInt(F.value),l=parseInt(T.value);isNaN(e)||isNaN(a)||isNaN(t)||isNaN(l)||_.value.forEach(((n,s)=>{((e,a,t,l,n,s,u)=>new Promise(((o,i)=>{if(void 0===e.base64)return void i("image no base64");if(s<0||s>.97)return void i("quality must be between 0 and 0.97");const v=new Image;v.onload=()=>{a<0&&(a=0),t<0&&(t=0),l<0&&(l=0),n<0&&(n=0),a+l>v.height&&(a=0,l=0),n+t>v.width&&(n=0,t=0);let e=n,i=a,p=v.width-n-t,r=v.height-a-l;const c=document.createElement("canvas");c.width=p,c.height=r,c.getContext("2d").drawImage(v,e,i,p,r,0,0,p,r);const d="image/jpeg",h=c.toDataURL(d,s);let m=h.length-`data:${d};base64,`.length;m=parseInt(m-m/4);const g=Date.parse(new Date)/100+u;o({size:m,type:d,timeStamp:g,base64:h})},v.src=e.base64})))(n,e,a,t,l,.3,s).then((e=>{H.value.push(e)})).catch((e=>{}))}))}function A(){let e={name:"",top:R.value,right:$.value,bottom:F.value,left:T.value,cropData:G.value,points:P.value};x(e,N.value)||(N.value.push(e),y(C,N.value))}function J(e){R.value=e.top,$.value=e.right,F.value=e.bottom,T.value=e.left,G.value=e.cropData,P.value=e.points}function K(e){y(C,e)}return(e,a)=>(t(),l(c,null,[n(g,{multiple:"",onGetImage:E},{default:s((()=>[_.value.length>0?(t(),l("div",k,[u("button",{onClick:V},"选点"),i(u("input",{type:"text",placeholder:"x,y,width,height","onUpdate:modelValue":a[0]||(a[0]=e=>G.value=e),id:"cropData"},null,512),[[v,G.value]]),u("button",{onClick:L},"裁剪")])):p("",!0)])),_:1}),_.value.length>0?(t(),l("div",j,[u("div",null,[o("上："),i(u("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[1]||(a[1]=e=>R.value=e),class:"inp"},null,512),[[v,R.value]])]),u("div",null,[o("右："),i(u("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[2]||(a[2]=e=>$.value=e),class:"inp"},null,512),[[v,$.value]])]),u("div",null,[o("下："),i(u("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[3]||(a[3]=e=>F.value=e),class:"inp"},null,512),[[v,F.value]])]),u("div",null,[o("左："),i(u("input",{type:"text",placeholder:"px","onUpdate:modelValue":a[4]||(a[4]=e=>T.value=e),class:"inp"},null,512),[[v,T.value]])]),u("button",{onClick:W},"去边框")])):p("",!0),S.value&&_.value.length>0?(t(),r(I,{key:1,image:_.value[0],max:"2",onPointsGet:O,onPointsClear:q},{default:s((()=>[2===P.value.length?(t(),l("div",U,[(t(!0),l(c,null,d(P.value,(e=>(t(),l("div",{key:e,class:"msg"},[u("i",null,h(e.x)+", "+h(e.y),1)])))),128)),u("button",{onClick:z},"复制")])):p("",!0)])),_:1},8,["image"])):p("",!0),n(b,{images:_.value},null,8,["images"]),H.value.length>0?(t(),r(w,{key:2,images:H.value},null,8,["images"])):p("",!0),n(f,{dataObj:N.value,onHistory:A,onUse:J,onUpdata:K},null,8,["dataObj"])],64))}},[["__scopeId","data-v-cbb0ae34"]]);export{C as default};
